# 🏭 Smart Factory Client Application

یک اپلیکیشن کنسول برای دریافت داده‌های سنسور از Proteus و ارسال به API سیستم نظارت کارخانه هوشمند.

## ✨ ویژگی‌ها

- **📡 ارتباط سریال**: دریافت داده از پورت COM
- **🔍 پردازش داده**: تجزیه و اعتبارسنجی داده‌های سنسور
- **🌐 ارسال API**: ارسال داده به سرور مانیتورینگ
- **🔄 بازیابی خودکار**: تلاش مجدد در صورت خطا
- **📊 آمار عملکرد**: نمایش آمار ارسال و دریافت
- **🎭 حالت شبیه‌سازی**: تولید داده تصادفی در صورت عدم دسترسی به COM

## 🚀 راه‌اندازی

### پیش‌نیازها:
- .NET 9.0 SDK
- پورت COM فعال (برای اتصال به Proteus)
- دسترسی به API سرور

### نصب و اجرا:

1. **رفتن به پوشه پروژه:**
```bash
cd ClientConsoleApp/SmartFactoryClient
```

2. **بازیابی پکیج‌ها:**
```bash
dotnet restore
```

3. **ساخت پروژه:**
```bash
dotnet build
```

4. **اجرای برنامه:**
```bash
dotnet run
```

## ⚙️ پیکربندی

فایل `appsettings.json` را برای تنظیمات مختلف ویرایش کنید:

### تنظیمات API:
```json
{
  "SmartFactory": {
    "ApiBaseUrl": "http://localhost:5000/api",
    "ApiEndpoint": "/sensor/raw",
    "RetryAttempts": 3,
    "RetryDelay": 2000
  }
}
```

### تنظیمات پورت سریال:
```json
{
  "SerialPort": {
    "PortName": "COM1",
    "BaudRate": 9600,
    "Parity": "None",
    "DataBits": 8,
    "StopBits": "One",
    "Handshake": "None",
    "ReadTimeout": 5000,
    "WriteTimeout": 5000
  }
}
```

### تنظیمات برنامه:
```json
{
  "Application": {
    "LogLevel": "Information",
    "DataSendInterval": 1000,
    "MaxRetries": 5,
    "EnableConsoleOutput": true,
    "EnableFileLogging": false
  }
}
```

## 📡 فرمت داده‌های Proteus

برنامه انتظار داده به فرمت زیر را دارد:

```
Smart Factory Monitoring System - AUTOMATIC MODE - ONLINE
Furnace_Temp:892.00,Env_Humid:0.00,Light_Level:210,Gas_Methane:0,Gas_CO:61,Machine_Sound:512,Tank_Pressure:72,Main_Current:123,Engine_Vibe:0,Input_Voltage:0,Conveyor_Dist:0,Water_Leak:512,Flame_Status:0,Gate_Status:0,E_Stop_Button:0,Coolant_Valve:90
```

### ساختار داده:
- **خط اول**: وضعیت سیستم (حالت و وضعیت آنلاین/آفلاین)
- **خط دوم**: مقادیر سنسورها به فرمت `Key:Value` جدا شده با کاما

## 🎮 دستورات تعاملی

در حین اجرا، کلیدهای زیر را می‌توانید استفاده کنید:

- **[S]** - نمایش آمار عملکرد
- **[T]** - ارسال داده تست
- **[C]** - تست اتصال API
- **[P]** - نمایش وضعیت پورت سریال
- **[M]** - نمایش منو
- **[Q]** - خروج از برنامه

## 📊 نمونه خروجی

```
🏭 Smart Factory Client - Interactive Mode
==================================================
Commands:
  [S] Show Statistics
  [T] Send Test Data
  [C] Test API Connectivity
  [P] Show Serial Port Status
  [M] Show This Menu
  [Q] Quit
==================================================
Listening for data from Proteus...

[10:30:15] 📡 Data received from Proteus: Smart Factory Monitoring System - AUTOMATIC MODE - ONLINE | Furnace_Temp:892.00,Env_Humid:0.00...
[10:30:15] ✅ Data sent to API successfully: [10:30:15] Temp: 892°C, Pressure: 72 PSI, Gas_CO: 61 ppm, Status: ONLINE
```

## 🔧 عیب‌یابی

### مشکلات رایج:

1. **پورت COM یافت نشد:**
   - بررسی کنید Proteus در حال اجرا باشد
   - نام پورت در `appsettings.json` را بررسی کنید
   - برنامه به صورت خودکار اولین پورت موجود را انتخاب می‌کند

2. **خطای اتصال API:**
   - مطمئن شوید سرور API در حال اجرا باشد
   - آدرس API در تنظیمات را بررسی کنید
   - فایروال یا آنتی‌ویروس ممکن است اتصال را مسدود کند

3. **داده نامعتبر:**
   - فرمت داده از Proteus را بررسی کنید
   - لاگ‌های خطا را برای جزئیات بیشتر مطالعه کنید

## 🎭 حالت شبیه‌سازی

اگر پورت COM در دسترس نباشد، برنامه به صورت خودکار وارد حالت شبیه‌سازی می‌شود و داده‌های تصادفی تولید می‌کند:

- داده‌ها با تغییرات تصادفی تولید می‌شوند
- احتمال کم برای رویدادهای خاص (آتش، درب باز، اضطرار)
- ارسال مداوم با فاصله زمانی قابل تنظیم

## 📝 لاگ‌ها

برنامه اطلاعات مفیدی را در کنسول نمایش می‌دهد:

- **📡** دریافت داده از Proteus
- **✅** ارسال موفق به API
- **❌** خطاها و مشکلات
- **📊** آمار عملکرد
- **🔍** تست‌های اتصال

## 🏗️ معماری

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│     Proteus     │───▶│  Serial Port    │───▶│   Data Parser   │
│   (COM Port)    │    │    Service      │    │    Service      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Smart Factory  │◀───│   API Client    │◀───│      Main       │
│   API Server    │    │    Service      │    │    Service      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🔄 نحوه کار

1. **شروع**: برنامه تلاش می‌کند به پورت COM متصل شود
2. **دریافت**: داده‌ها از Proteus دریافت می‌شوند
3. **پردازش**: داده‌ها تجزیه و اعتبارسنجی می‌شوند
4. **ارسال**: داده‌های معتبر به API ارسال می‌شوند
5. **بازیابی**: در صورت خطا، تلاش مجدد انجام می‌شود
6. **آمار**: نتایج ثبت و نمایش داده می‌شوند

## 🤝 پشتیبانی

برای مشکلات فنی:
1. لاگ‌های خطا را بررسی کنید
2. تنظیمات پورت سریال را تأیید کنید
3. اتصال شبکه و API را تست کنید

---
**توسعه‌یافته برای پایان‌نامه هوشمندسازی کارخانه صنعتی** 🎓